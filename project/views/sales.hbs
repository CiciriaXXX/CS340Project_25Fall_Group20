 {{!--
 Citation for the following code:
 Date: 11/19/2025
 This file's structure is adapted from the OSU CS 340 starter code.
 All variables, queries, and application-specific logic have been rewritten 
 for our project requirements.
 https://canvas.oregonstate.edu/courses/2017561/pages/exploration-web-application-technology-2?module_item_id=25645131
 https://canvas.oregonstate.edu/courses/2017561/pages/exploration-implementing-cud-operations-in-your-app?module_item_id=25645149
 --}}
 
<h1>Sales</h1>

{{! READ table }}
<table>
  <thead>
    <tr>
      <th>Sale ID</th>
      <th>Sale Date</th>
      <th>Customer Full Name</th>
      <th>Employee Full Name</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {{#each sales}}
    <tr>
      <td>{{this.saleID}}</td>
      <td>{{this.saleDate}}</td>
      <td>{{this.customerFullName}}</td>
      <td>{{this.employeeFullName}}</td>

      {{! DELETE form }}
       <td>
        <form method="POST" action="/delete-sale">
            <input type="hidden" name="delete_saleID" value="{{this.saleID}}">
            <button type="submit">Delete</button>
        </form>
       </td>
    </tr>
    {{/each}}
  </tbody>
</table>

{{! CREATE form }}
<h2>Add a New Sale</h2>
<form class="cuForm" id="create_sale_form" method="POST" action="/create-sale">
  <label for="create_customerIDInput">Customer:</label>
  <select name="create_customerIDInput" id="create_customerIDInput" >
    <option value="" disabled selected>Select a Customer</option>
    <option value="">Not Registered</option>
    {{#each customers}}
    <option value="{{this.customerID}}">{{this.customerFullName}}</option>
    {{/each}}
  </select>

  <label for="create_employeeIDInput">Employee:</label>
  <select name="create_employeeIDInput" id="create_employeeIDInput" required>
    <option value="" disabled selected>Select an Employee</option>
    {{#each employees}}
    <option value="{{this.employeeID}}">{{this.employeeFullName}}</option>
    {{/each}}
  </select>

  <label for="create_saleDateInput">Sale Date:</label>
  <input type="date" name="create_saleDateInput" id="create_saleDateInput" required>

  <input type="submit" value="Add Sale">
</form>

{{! UPDATE form }}
<h2>Update a Sale</h2>
<form class="cuForm" id="update_sale_form" method="POST" action="/update-sale">
  <label for="update_saleIDInput">Select Sale:</label>
  <select name="update_saleIDInput" id="update_saleIDInput" required>
    <option value="" disabled selected>Select a Sale</option>
    {{#each sales}}
    <option value="{{this.saleID}}">{{this.saleID}}</option>
    {{/each}}
  </select>

  <label for="update_customerIDInput">Customer:</label>
  <select name="update_customerIDInput" id="update_customerIDInput" >
    <option value="" disabled selected>Select a Customer</option>
    <option value="">Not Registered</option>
    {{#each customers}}
    <option value="{{this.customerID}}">{{this.customerFullName}}</option>
    {{/each}}
  </select>

  <label for="update_employeeIDInput">Employee:</label>
  <select name="update_employeeIDInput" id="update_employeeIDInput" required>
    <option value="" disabled selected>Select an Employee</option>
    {{#each employees}}
    <option value="{{this.employeeID}}">{{this.employeeFullName}}</option>
    {{/each}}
  </select>

  <label for="update_saleDateInput">Sale Date:</label>
  <input type="date" name="update_saleDateInput" id="update_saleDateInput"required>

  <input type="submit" value="Update Sale">
</form>
<script>
    // Script to pre-fill update form fields based on selected sale
    document.getElementById("update_saleIDInput").addEventListener("change", async function() {
      const id = this.value;
      const response = await fetch(`/api/sale/${id}`);
      const sale = await response.json();
      document.getElementById("update_customerIDInput").value = sale.customerID || "";
      document.getElementById("update_employeeIDInput").value = sale.employeeID;
      document.getElementById("update_saleDateInput").value = sale.saleDate.split('T')[0];
});
</script>